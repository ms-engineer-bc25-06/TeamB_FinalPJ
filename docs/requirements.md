# 要件定義書

## 目的

本ドキュメントは、感情教育アプリ『きもちみっけ！』の機能要件・非機能要件を明確に定義し、開発チームが実装すべき機能と品質基準を共有することを目的としています。

## このドキュメントの使い方

機能要件・非機能要件の詳細を確認したい時に参照してください。開発時の仕様確認に使用します。

<!-- 要件定義 -->

### 1. ドキュメント情報

- **ドキュメント名**：「感情分析アプリ（仮名） 要件定義書」

- **作成日**：2025 年 7 月 31 日

- **作成者**：TeamB みお

- **バージョン履歴**：
- v1.0 初版作成（2025/07/31）
- v1.1 初版変更（2025/08/5） 変更点：10. 制約事項・前提条件
- v1.2 初版変更（2025/09/5） 変更点：### 3. 用語定義

---

### 2. プロジェクト概要

- **システム名**：感情分析アプリ（仮名）

- **システムの目的・背景**：

  > 本アプリは非認知能力・EQ の重要性に気づいてはいるけど何から手をつけたらいいか、どうやって高めたらいいか困っている親御さん向けに、子どもの感情表現能力を育むツールを提供するべく開発する。</p>

- **関係者**：

- 講師：ryo さん

- 開発チーム：TeamB（Rena, Sayaka, Nami, Mio）

---

### 3. 用語定義

| 用語 | 定義                                          |
| ---- | --------------------------------------------- |
| EQ   | Emotional Intelligence Quotient、感情的知性。 |

---

### 4. 業務フロー（As-Is / To-Be）

- **現在の業務（As-Is）**：

> 幼児向けの EQ 教育方法として既に市販の感情カードや感情絵本もあるが、紙媒体では習慣化が難しく、親の側も記録・振り返りがしにくい。

- **新システムでの業務フロー（To-Be）**：

- フローチャート：<a>docs/UIDesign.md</a>に記載の通り

- ユーザーストーリー

#### Before（アプリ導入前）

> 5 歳の子どもを育てるワーキングマザー、みさきさん。  
> EQ や感情教育の重要性を本や SNS で知ったが、忙しくて絵本やカードを継続できない。  
> 子どもの本音や感情を把握するのが難しく、すれ違いを感じることがある。

#### After（アプリ活用後）

> アプリを通して、毎晩のルーティンに「今日の気持ちチェック」が加わった。  
> 子どもがカードを選びながら「きょうはかなしかった」など言えるようになり、  
> 親も感情の理由を知ることで、**共感や対話が自然と生まれるように**なった。  
> 「またこころんと話したい！」と、子ども自身が楽しみにする日課にもなっている。

---

### 5. 機能要件

| ID     | 機能名               | 概要                                                                   | 詳細仕様                                          | 実装状況    |
| ------ | -------------------- | ---------------------------------------------------------------------- | ------------------------------------------------- | ----------- |
| FR-000 | キャラクター         | TOP/感情カード選択/感情強度選択/音声入力/音声入力完了/ロールプレイ画面 | こころんキャラクター（GIF/WebP）                  | ✅ 実装済み |
| FR-001 | 感情カード選択機能   | 感情カードをクリックで選択                                             | クリック選択 　　　　　　　　　　　　　　　　　　 | ✅ 実装済み |
| FR-002 | 感情の度合い選択     | ３段階の大きさを示すボタンから選択可能                                 | よわい・ふつう・つよいの 3 段階                   | ✅ 実装済み |
| FR-003 | 音声入力記録         | 理由をマイクで話して記録                                               | WhisperAPI でテキスト化                           | ✅ 実装済み |
| FR-004 | レポート             | 日次・週次レポートの表示                                               | 日次・週次レポートモーダル表示                    | ✅ 実装済み |
| FR-005 | レポート             | 1 週間の振り返りを AI で生成                                           | 記録数集計は実装済み、AI 分析は未実装             | ⚠️ 部分実装 |
| FR-006 | ロールプレイ         | 感情教育とは・重要性                                                   | AppRouter                                         | ✅ 実装済み |
| FR-007 | 感情教育             | 感情教育とは・重要性                                                   | AppRouter                                         | ✅ 実装済み |
| FR-008 | 非認知能力           | 非認知能力とは・重要性・どう育てるか                                   | AppRouter                                         | ✅ 実装済み |
| FR-009 | 保護者向け Tips(FAQ) | 使い方ガイド                                                           | AppRouter                                         | ✅ 実装済み |

---

### 6. 非機能要件

| 項目           | 内容                                       | 実装状況    |
| -------------- | ------------------------------------------ | ----------- |
| パフォーマンス | 通信レスポンスは 2 秒以内（90%以上）       | ⚠️ 要測定   |
| 可用性         | オフライン時も感情記録が一時保存されること | ❌ 未実装   |
| 対応端末       | モバイルファースト設計（iOS/Android 対応） | ✅ 実装済み |

---

### 7. 画面一覧・仕様

- 詳細は[UIDesign](./UIDesign.md)を参照してください
  <!-- TODO: ある程度決まったら以下に反映すること -->

| 画面 ID | 画面名     | 概要                    | 遷移元     | 遷移先                 |
| ------- | ---------- | ----------------------- | ---------- | ---------------------- |
| UI-001  | ホーム画面 | アプリの起点画面        | ログイン後 | 感情記録画面           |
| UI-002  | 感情記録   | スワイプ選択 → 音声入力 | ホーム画面 | 感情履歴、スタンプ画面 |

> ✅ 入力項目、バリデーション条件、ボタン配置なども別途記載。ワイヤーフレームは Figma へのリンクを追って記載。

---

### 8. データ要件

  <!-- TODO: DBの内容が決まったら以下変更すること -->

#### 🗂️ データ構造と項目

| カテゴリ     | 項目名          | 型／形式          | 説明・制約例                                    |
| ------------ | --------------- | ----------------- | ----------------------------------------------- |
| ユーザー情報 | user_id         | UUID / string     | ユーザー（保護者）を一意に識別する ID           |
|              | child_name      | string            | 子どもの名前（ニックネームなど）                |
|              | child_age       | number            | 子どもの年齢（任意）                            |
|              | created_at      | datetime          | ユーザー登録日時                                |
| 感情記録     | record_id       | UUID / string     | 感情記録を一意に識別                            |
|              | user_id         | string            | ユーザー（親）との紐づけ                        |
|              | child_id        | string            | 子どもとの紐づけ                                |
|              | emotion_card_id | string            | 選択された感情カード ID（単一選択）             |
|              | intensity_id    | integer           | 感情の強度 ID（1-3 の 3 段階）                  |
|              | voice_note      | string（長文可）  | 感情の理由（音声入力 → テキスト変換されたもの） |
|              | audio_file_path | string（S3 パス） | 音声ファイルの S3 保存先パス                    |
|              | text_file_path  | string（S3 パス） | テキストファイルの S3 保存先パス                |
|              | created_at      | datetime          | 記録された日時                                  |
| 感情マスター | emotion_id      | UUID / string     | 感情カード ID                                   |
|              | label           | string            | 表示ラベル（日本語名など）                      |
|              | image_url       | string / URL      | 表示画像 URL                                    |
|              | color           | string            | 表示カラーコード（例：#FFB6C1）                 |
| 強度マスター | intensity_id    | integer           | 強度 ID（1-3）                                  |
|              | color_modifier  | integer           | 色の明度変更値                                  |

---

#### 🧾 データ管理ルール

- **保存期間**：感情記録データは原則 1 年間保存。1 年経過した記録は自動削除またはアーカイブ。
- **整合性**：
  - `user_id` は必須。退会時はユーザー情報削除とともに感情記録も削除。
  - `child_id` は必須。感情記録は必ず子どもと紐づけられる。
  - 感情カード ID は感情マスターに存在するもののみ登録可。
  - 強度 ID は 1-3 の範囲内のみ登録可。
- **重複制御**：
  - 同一日に複数回記録は可能とする（ただし後の集計で日単位の上限をつける可能性あり）

---

#### 📊 データ利用想定

- 感情記録の履歴表示（日次・週次レポート）
- 日次レポート：1 日の感情記録の詳細表示
- 週次レポート：1 週間の感情傾向レポート表示（AI 分析は未実装）
- 将来的には感情の傾向グラフ（週・月別）への展開も視野に入れる

---

### 9. 外部連携・API 要件

| 外部サービス  | 概要                           | 方法         | 形式 | 実装状況    |
| ------------- | ------------------------------ | ------------ | ---- | ----------- |
| Whisper API   | 音声入力のテキスト変換         | REST API     | JSON | ✅ 実装済み |
| Firebase Auth | ユーザー認証機能               | Firebase SDK | -    | ✅ 実装済み |
| PostgreSQL    | リレーショナルデータベース     | SQLAlchemy   | SQL  | ✅ 実装済み |
| AWS S3        | 音声ファイルの保存             | boto3        | -    | ✅ 実装済み |
| Stripe        | 決済・サブスクリプション管理   | REST API     | JSON | ✅ 実装済み |
| Vercel        | アプリのデプロイ／ホスティング | GitHub 連携  | -    | ⚠️ 実装予定 |

> 🔍 補足：Whisper API は音声データを S3 にアップロード後、S3 パスを指定してテキスト変換を実行する構成

---

### 10. 制約事項・前提条件

- ユーザー登録は保護者のみ。子どもは保護者のアカウント内で記録する想定
- 感情カード選択：クリック選択
- 音声録音は WebM 形式を推奨（WAV、MP3、M4A も対応）
- 一部機能はスマートフォン・タブレット向けに最適化（PC では UI 調整が必要）
- オフライン時の一時保存機能は未実装
- 週次レポート：記録数集計は実装済み、AI 分析は未実装

---

### 11. リスクと対応方針

<!-- TODO: 何を書くか確認して、記載 -->

| リスク内容                                   | 対応方針                                                                   | 実装状況    |
| -------------------------------------------- | -------------------------------------------------------------------------- | ----------- |
| 音声認識の精度が低い場合がある               | 再録機能を実装済み／テキスト入力による代替手段を検討                       | ✅ 対応済み |
| 子どもが毎日スマホを触ることによる依存       | 利用時間を制限するガイドライン提示／操作補助を親に促す                     | ⚠️ 要検討   |
| Whisper API が有料化・上限超過になる可能性   | 月間使用量を制限し、無料枠内での利用にとどめる仕組みを検討                 | ⚠️ 要検討   |
| 感情カードや履歴データに不整合が起きる可能性 | バックアップ保存＋バリデーションチェックを実装                             | ✅ 対応済み |
| フロント・バックエンドの同期不具合           | ローディング状態の明示／再送信処理を備える                                 | ✅ 対応済み |
| アクセス集中時のパフォーマンス低下           | Vercel CDN + PostgreSQL バックエンドで負荷分散／スケーラブル設計を心がける | ✅ 対応済み |
