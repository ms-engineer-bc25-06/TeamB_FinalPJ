# 技術スタック

## 目的

本ドキュメントは、感情教育アプリ『きもちみっけ！』で採用している技術スタックの詳細と採用理由を明確にし、開発チームが技術選択の背景を理解し、新メンバーのキャッチアップを効率化することを目的としています。

## このドキュメントの使い方

使用技術の詳細や採用理由を確認したい時に参照してください。新メンバーのキャッチアップや技術選定の参考資料です。

## 🛠️ 技術スタック

このドキュメントは、本プロジェクトで採用している主要な技術・ツールの一覧と、その用途・役割をまとめたものです。
開発・運用・保守・新メンバーのキャッチアップをサポートするため、常に最新情報を保つよう心がけてください。

## 🌐 フロントエンド

| 技術                       | 概要                         | 採用理由・特徴                                      |
| -------------------------- | ---------------------------- | --------------------------------------------------- |
| Next.js（TypeScript）      | React ベースのフレームワーク | App Router 対応、SSR/静的生成対応、デプロイしやすい |
| カスタム UI コンポーネント | 独自実装の UI コンポーネント | 子ども向けデザインに最適化、一貫性のある UI         |
| Firebase Auth              | 認証ライブラリ               | Google OAuth2.0 認証、セッション管理                |

## ⚡ バックエンド

| 技術              | 概要                                | 採用理由・特徴                             |
| ----------------- | ----------------------------------- | ------------------------------------------ |
| FastAPI（Python） | 高速な非同期対応 Web フレームワーク | 外部連携が容易、自動ドキュメント生成が強力 |
| Pydantic          | データバリデーションライブラリ      | バリデーションとシリアライズに活用         |
| SQLAlchemy        | Python ORM                          | DB 操作を抽象化し、PostgreSQL と連携       |
| psycopg[binary]   | PostgreSQL ドライバー               | 本番環境用の安定したドライバー             |
| PostgreSQL        | リレーショナルデータベース          | 高性能かつ拡張性が高い                     |
| Alembic           | データベースマイグレーションツール  | スキーマ変更の管理                         |

## 🔐 認証・ユーザー管理

| 技術                    | 概要                                                  |
| ----------------------- | ----------------------------------------------------- |
| Firebase Authentication | Google OAuth2.0 認証、セッション管理、ID トークン検証 |
| Firebase Admin SDK      | サーバーサイド認証検証、ユーザー管理                  |

## 🧠 AI・音声関連

### 音声処理フロー

```
User → MediaRecorder API → S3 → Whisper → Application → Database
（音声録音 → S3保存 → テキスト変換 → 処理 → データベース保存）
```

| 技術              | 用途            | 特徴                                                |
| ----------------- | --------------- | --------------------------------------------------- |
| MediaRecorder API | 音声録音        | ユーザー音声を録音し S3 へ送信                      |
| OpenAI Whisper    | 音声認識（STT） | ローカルモデル使用、高精度な音声 → テキスト変換     |
| FFmpeg            | 音声最適化      | 16kHz/モノラル/16bit に変換、ファイルサイズ 70%削減 |
| boto3             | S3 連携         | AWS S3 へのファイルアップロード・ダウンロード       |

🎨 UI/UX（子ども向けの工夫）
| 工夫 | 内容 |
| ---------------- | ------------------------ |
| カード UI | 視覚的・直感的な操作性を実現 |
| アバター・ガイドキャラ（GIF） | 対話感と親しみやすさを強化 |
| 感情記録カレンダー（カスタム実装） | 感情ログを日別に可視化し、レポート活用 |
| モーダル（カスタム実装） | 簡易選択 UI として使用（例：「はい」「いいえ」） |

🧠 共感力・行動選択トレーニング
| 機能 | 説明 |
| ------------- | --------------------- |
| シナリオ出題 | 共感・行動選択を促す問いかけを実施 |
| ログ記録 → レポート反映 | ユーザーの選択や反応を記録し、保護者と共有 |

## 💳 決済

| 技術       | 特徴                                                                     |
| ---------- | ------------------------------------------------------------------------ |
| Stripe     | サブスクリプション対応、Webhook 連携、テスト環境完備、セキュアな決済処理 |
| Stripe CLI | ローカル開発用 Webhook 転送、テストイベント送信                          |

## 📱 ネイティブアプリに近づける工夫

| 技術・機能                   | 実装状況    | 説明                                       |
| ---------------------------- | ----------- | ------------------------------------------ |
| レスポンシブ対応             | ✅ 実装済み | CSS メディアクエリでスマホ・タブレット対応 |
| PWA（Progressive Web App）   | ❌ 未実装   | インストール可能な Web アプリ体験          |
| プッシュ通知・オフライン閲覧 | ❌ 未実装   | モバイル UX を強化（余力があれば実装）     |

## 🧪 テスト

### コード品質ツール

| 対象           | ツール            | 目的                |
| -------------- | ----------------- | ------------------- |
| フロントエンド | ESLint / Prettier | 静的解析 / 自動整形 |
| バックエンド   | Pylint / black    | 静的解析 / 自動整形 |

### テストフレームワーク

| 種類   | フロント | バックエンド | E2E                                    |
| ------ | -------- | ------------ | -------------------------------------- |
| ツール | Vitest   | Pytest       | Playwright                             |
| 状況   | 実装済み | 実装済み     | 認証・音声・サブスクリプション実装済み |

### テスト戦略

- **単体テスト**: フロントエンド・バックエンドの基本機能テスト
- **統合テスト**: API エンドポイントの存在確認テスト
- **E2E テスト**: 認証・音声・サブスクリプション機能の自動テスト（感情記録フローは未実装）

## ⚙️ 開発環境・CI/CD

| 技術・運用              | 説明                                     |
| ----------------------- | ---------------------------------------- |
| Docker / Docker Compose | 開発環境を統一し、複数サービスを一括管理 |
| GitHub + GitHub Flow    | PR ベース開発、`develop`ブランチ中心運用 |
| GitHub Actions          | テスト・ビルド等を自動実行               |
| Vercel                  | フロントエンドのデプロイ・ホスティング   |
| Cloud Run               | バックエンドのデプロイ・ホスティング     |
| Cloud SQL               | 本番データベース（PostgreSQL）           |

このドキュメントは、技術やツールに変更があった際に都度更新してください。  
常に最新の技術構成をチーム全員で把握・共有することがプロジェクトの成功につながります。
